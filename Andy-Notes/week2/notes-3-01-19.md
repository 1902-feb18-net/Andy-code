# Revature 3-01-19 Notes

## [Repository Pattern](https://deviq.com/repository-pattern/)
- provides an abstraction of data
	- adding, removing, updates, and select done through series of straightforward methods
	- no DB headache (connections, commands, cursors, readers)
	- loose coupling
- a method is a *Repository per entity or business Object*
	- should only implement specific methods called in your app
-another is a *generic repository interface*
	- common interface for working with any of your objects
- 	```sql
		public class Repository<T> : IRepository<T> where T : EntityBase
		{
		    private readonly ApplicationDbContext _dbContext;
		    public Repository(ApplicationDbContext dbContext)
		    {
		        _dbContext = dbContext;
		    }
		    public virtual T GetById(int id)
		    {
		        return _dbContext.Set<T>().Find(id);
		    }
		    public virtual IEnumerable<T> List()
		    {
		        return _dbContext.Set<T>().AsEnumerable();
		    }
		    public virtual IEnumerable<T> List(System.Linq.Expressions.Expression<Func<T, bool>> predicate)
		    {
		        return _dbContext.Set<T>()
		               .Where(predicate)
		               .AsEnumerable();
		    }
		    public void Insert(T entity)
		    {
		        _dbContext.Set<T>().Add(entity);
		        _dbContext.SaveChanges();
		    }
		    public void Update(T entity)
		    {
		        _dbContext.Entry(entity).State = EntityState.Modified;
		        _dbContext.SaveChanges();
		    }
		    public void Delete(T entity)
		    {
		        _dbContext.Set<T>().Remove(entity);
		        _dbContext.SaveChanges();
		    }
		}
	```

## [DB Logging](https://docs.microsoft.com/en-us/ef/core/miscellaneous/logging)
-

## [Loading](https://docs.microsoft.com/en-us/ef/core/querying/related-data)
- **Eager loading** means that the related data is loaded from the database as part of the initial query.
	- You can use the `Include` method to specify related data to be included in query results
		- join of two separate tables
		- e.g. a <- main -> b
	- You can chain multiple calls to `ThenInclude` to continue including further levels of related data.
		- join of two levels deep
		- e.g. main -> a -> b
- **Lazy loading** means that the related data is transparently loaded from the database when the navigation property is accessed.
	- gets expoentially worse as you go deeper, AVOID in real apps

## EF Notes
- There's a redundant data in what EF returns, especially when

## Project 0 advice
- if encounter NULL somewhere, you probably missed an Include somewhere

### DATABASE Plan
- Location:
	- StoreId (INT)
	- Store Name (NVARCHAR)
	- CustomerId (INT)(location depends on customer FK to Customer)
- Inventory
	- StoreId (INT) (FK to location)
	- items (MONEY, count(INT))
- Order
	- OrderId (INT) (Fk to Customers)
	- StoreId (INT) (FK to Store)
	- Date Bought (DATETIME2)
	- Sum (INT)
- Customer
	- CustomerId (INT) PK
	- FirstName (NVARCHAR)
	- LastName (NVARCHAR)
	- defaultStoreId (INT)